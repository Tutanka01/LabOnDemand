<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - LabOnDemand</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="Images/banner-projet.jpeg" type="image/jpeg">
    <link rel="stylesheet" href="css/admin.css">
    <!-- Dark mode ‚Äî appliqu√© avant le rendu pour √©viter le flash -->
    <script>
      (function(){var t=localStorage.getItem('labondemand-theme');document.documentElement.setAttribute('data-theme',t==='dark'?'dark':'light');})();
    </script>
    <script src="js/darkmode.js"></script>
</head>
<body>
    <div class="main-container">
        <header>
            <div class="logo">
                <i class="fas fa-cubes"></i> LabOnDemand
            </div>
            <nav>
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> Accueil</a></li>
                    <li class="admin-only active"><a href="admin.html"><i class="fas fa-users-cog"></i> Administration</a></li>
                    <li class="admin-only"><a href="admin-stats.html"><i class="fas fa-chart-line"></i> Statistiques</a></li>
                </ul>
            </nav>
            <div class="user-info">
                <span id="username-display"><i class="fas fa-user-circle"></i> <span id="current-username">Utilisateur</span></span>
                <div class="user-role" id="user-role">
                    <span class="role-badge">R√¥le</span>
                </div>
                <button id="dark-mode-toggle" class="dark-mode-toggle" onclick="toggleDarkMode()" title="Basculer le mode sombre" aria-label="Basculer le mode sombre">üåô</button>
                <button id="logout-btn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> D√©connexion
                </button>
            </div>
        </header>

        <main>
            <!-- ‚îÄ‚îÄ Notifications globales ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div class="notification-container">
                <div id="sso-admin-notice" class="notification info hidden">
                    <i class="fas fa-shield-alt"></i> Cr√©ation d'utilisateurs locaux d√©sactiv√©e (SSO activ√©)
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                </div>
                <div id="error-message" class="notification error">
                    <i class="fas fa-exclamation-circle"></i> <span id="error-text"></span>
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                </div>
                <div id="success-message" class="notification success">
                    <i class="fas fa-check-circle"></i> <span id="success-text"></span>
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ Syst√®me d'onglets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div class="admin-tabs">
                <nav class="tabs-nav" role="tablist">
                    <button class="tab-btn active" role="tab" data-tab="users" aria-selected="true">
                        <i class="fas fa-users"></i> Utilisateurs
                    </button>
                    <button class="tab-btn" role="tab" data-tab="templates" aria-selected="false">
                        <i class="fas fa-th-large"></i> Templates
                    </button>
                    <button class="tab-btn" role="tab" data-tab="runtimes" aria-selected="false">
                        <i class="fas fa-cogs"></i> Runtimes
                    </button>
                    <button class="tab-btn" role="tab" data-tab="labs" aria-selected="false">
                        <i class="fas fa-layer-group"></i> Parc des Labs
                    </button>
                </nav>

                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                     Onglet : Utilisateurs
                     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <div class="tab-panel active" id="tab-users" role="tabpanel">
                    <div class="tab-panel-header">
                        <h1><i class="fas fa-users"></i> Utilisateurs</h1>
                        <div class="page-header-actions">
                            <button id="import-csv-btn" class="action-btn action-btn--secondary">
                                <i class="fas fa-file-csv"></i> Importer CSV
                            </button>
                            <button id="add-user-btn" class="action-btn">
                                <i class="fas fa-user-plus"></i> Ajouter
                            </button>
                        </div>
                    </div>

                    <div class="filter-container">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="search-input" placeholder="Rechercher un utilisateur...">
                        </div>
                        <div class="filter-options">
                            <label>R√¥le :</label>
                            <select id="role-filter">
                                <option value="all">Tous</option>
                                <option value="student">√âtudiants</option>
                                <option value="teacher">Enseignants</option>
                                <option value="admin">Administrateurs</option>
                            </select>
                        </div>
                        <div class="filter-options">
                            <label>Auth :</label>
                            <select id="provider-filter">
                                <option value="all">Tous</option>
                                <option value="local">Local</option>
                                <option value="oidc">SSO</option>
                            </select>
                        </div>
                    </div>

                    <div class="users-table-container">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nom d'utilisateur</th>
                                    <th>Email</th>
                                    <th>Nom complet</th>
                                    <th>Auth</th>
                                    <th>R√¥le</th>
                                    <th>Statut</th>
                                    <th>Date de cr√©ation</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Rempli par JS -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination">
                        <button id="prev-page" class="pagination-btn" disabled>
                            <i class="fas fa-chevron-left"></i> Pr√©c√©dent
                        </button>
                        <span id="page-info">Page 1 sur 1</span>
                        <button id="next-page" class="pagination-btn" disabled>
                            Suivant <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                     Onglet : Templates
                     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <div class="tab-panel" id="tab-templates" role="tabpanel">
                    <div class="tab-panel-header">
                        <h1><i class="fas fa-th-large"></i> Templates d'applications</h1>
                        <button id="add-template-btn" class="action-btn">
                            <i class="fas fa-plus"></i> Nouveau template
                        </button>
                    </div>
                    <div id="templates-list" class="users-table-container">
                        <!-- Rempli par JS -->
                    </div>
                </div>

                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                     Onglet : Runtimes
                     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <div class="tab-panel" id="tab-runtimes" role="tabpanel">
                    <div class="tab-panel-header">
                        <h1><i class="fas fa-cogs"></i> Runtimes &amp; acc√®s √©tudiants</h1>
                        <button id="add-rc-btn" class="action-btn">
                            <i class="fas fa-plus"></i> Nouveau runtime
                        </button>
                    </div>
                    <div id="runtime-configs-list" class="users-table-container">
                        <!-- Rempli par JS -->
                    </div>
                </div>

                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                     Onglet : Parc des Labs
                     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <div class="tab-panel" id="tab-labs" role="tabpanel">
                    <div class="tab-panel-header">
                        <h1><i class="fas fa-layer-group"></i> Parc des Labs</h1>
                        <button id="refresh-labs-btn" class="action-btn action-btn--secondary">
                            <i class="fas fa-sync-alt"></i> Actualiser
                        </button>
                    </div>

                    <!-- Stat cards -->
                    <div class="labs-stat-cards" id="labs-stat-cards">
                        <div class="stat-card stat-card--active">
                            <div class="stat-card__value" id="stat-active">‚Äî</div>
                            <div class="stat-card__label"><i class="fas fa-play-circle"></i> Actifs</div>
                        </div>
                        <div class="stat-card stat-card--paused">
                            <div class="stat-card__value" id="stat-paused">‚Äî</div>
                            <div class="stat-card__label"><i class="fas fa-pause-circle"></i> En pause</div>
                        </div>
                        <div class="stat-card stat-card--expired">
                            <div class="stat-card__value" id="stat-expired">‚Äî</div>
                            <div class="stat-card__label"><i class="fas fa-hourglass-end"></i> Expir√©s</div>
                        </div>
                        <div class="stat-card stat-card--total">
                            <div class="stat-card__value" id="stat-total">‚Äî</div>
                            <div class="stat-card__label"><i class="fas fa-layer-group"></i> Total</div>
                        </div>
                    </div>

                    <!-- Filtres -->
                    <div class="filter-container">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="labs-search" placeholder="Rechercher un lab ou propri√©taire...">
                        </div>
                        <div class="filter-options">
                            <label>Statut :</label>
                            <select id="labs-status-filter">
                                <option value="all">Tous</option>
                                <option value="active">Actifs</option>
                                <option value="paused">En pause</option>
                                <option value="expired">Expir√©s</option>
                                <option value="deleted">Supprim√©s</option>
                            </select>
                        </div>
                        <div class="filter-options">
                            <label>Type :</label>
                            <select id="labs-type-filter">
                                <option value="all">Tous</option>
                                <option value="vscode">VSCode</option>
                                <option value="jupyter">Jupyter</option>
                                <option value="wordpress">WordPress</option>
                                <option value="lamp">LAMP</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        <span id="labs-count" class="labs-count"></span>
                    </div>

                    <!-- Tableau dense -->
                    <div class="users-table-container">
                        <table class="users-table labs-table" id="labs-table">
                            <thead>
                                <tr>
                                    <th>Lab</th>
                                    <th>Propri√©taire</th>
                                    <th>Type</th>
                                    <th>Statut</th>
                                    <th>Expiration</th>
                                    <th>Cr√©√© le</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="labs-table-body">
                                <tr>
                                    <td colspan="7" class="table-loading">
                                        <i class="fas fa-spinner fa-spin"></i> Chargement...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Modal : Ajout/modification utilisateur
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title"><i class="fas fa-user-plus"></i> Ajouter un utilisateur</h2>
                <button class="close-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="modal-error-message" class="notification error hidden">
                    <i class="fas fa-exclamation-circle"></i> <span id="modal-error-text"></span>
                    <button class="close-btn" onclick="this.parentElement.style.display='none'"><i class="fas fa-times"></i></button>
                </div>
                <form id="user-form">
                    <input type="hidden" id="user-id">

                    <div id="modal-sso-notice" class="notification info hidden">
                        <i class="fas fa-shield-alt"></i> Compte SSO ‚Äî le mot de passe est g√©r√© par le fournisseur d'identit√©.
                    </div>

                    <div class="form-group">
                        <label for="modal-username"><i class="fas fa-user"></i> Nom d'utilisateur</label>
                        <input type="text" id="modal-username" required minlength="3" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="modal-email"><i class="fas fa-envelope"></i> Email</label>
                        <input type="email" id="modal-email" required>
                    </div>
                    <div class="form-group">
                        <label for="modal-full-name"><i class="fas fa-id-card"></i> Nom complet</label>
                        <input type="text" id="modal-full-name">
                    </div>
                    <div class="form-group">
                        <label for="modal-password"><i class="fas fa-lock"></i> Mot de passe</label>
                        <input type="password" id="modal-password" minlength="8">
                        <small id="password-hint">Minimum 8 caract√®res. Laissez vide pour ne pas modifier le mot de passe.</small>
                    </div>
                    <div class="form-group">
                        <label for="modal-role"><i class="fas fa-user-tag"></i> R√¥le</label>
                        <select id="modal-role" required>
                            <option value="student">√âtudiant</option>
                            <option value="teacher">Enseignant</option>
                            <option value="admin">Administrateur</option>
                        </select>
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="modal-is-active" checked>
                        <label for="modal-is-active">Compte actif</label>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel close-modal">Annuler</button>
                        <button type="submit" class="btn-save">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Modal : Confirmation suppression utilisateur
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Confirmation</h2>
                <button class="close-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p>√ätes-vous s√ªr de vouloir supprimer l'utilisateur <span id="delete-user-name"></span> ?</p>
                <p class="warning">Cette action est irr√©versible.</p>
                <div class="form-actions">
                    <button type="button" class="btn-cancel close-modal">Annuler</button>
                    <button type="button" id="confirm-delete" class="btn-delete">Supprimer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Modal : Templates (cr√©ation/√©dition)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="template-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="template-modal-title"><i class="fas fa-th-large"></i> Nouveau template</h2>
                <button class="close-template-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="template-form">
                    <input type="hidden" id="template-id">

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tpl-key"><i class="fas fa-key"></i> Cl√©</label>
                            <input type="text" id="tpl-key" required minlength="2" maxlength="50" placeholder="vscode">
                            <small>Identifiant unique (ex: vscode, jupyter, custom)</small>
                        </div>
                        <div class="form-group">
                            <label for="tpl-name"><i class="fas fa-tag"></i> Nom</label>
                            <input type="text" id="tpl-name" required minlength="2" maxlength="100" placeholder="VSCode Web">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="tpl-description"><i class="fas fa-align-left"></i> Description</label>
                        <input type="text" id="tpl-description" maxlength="255" placeholder="Courte description">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tpl-icon"><i class="fas fa-icons"></i> Ic√¥ne (classe ou emoji)</label>
                            <input type="text" id="tpl-icon" maxlength="100" placeholder="fa-solid fa-code ou üß™">
                            <small>Classe Font Awesome ou emoji</small>
                        </div>
                        <div class="form-group">
                            <label for="tpl-type"><i class="fas fa-cubes"></i> Runtime</label>
                            <select id="tpl-type">
                                <option value="custom">Custom</option>
                                <option value="vscode">VSCode</option>
                                <option value="jupyter">Jupyter</option>
                                <option value="wordpress">WordPress</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tpl-image"><i class="fas fa-box"></i> Image par d√©faut</label>
                            <input type="text" id="tpl-image" maxlength="200" placeholder="ex: tutanka01/k8s:vscode">
                        </div>
                        <div class="form-group">
                            <label for="tpl-port"><i class="fas fa-plug"></i> Port par d√©faut</label>
                            <input type="number" id="tpl-port" min="1" max="65535" placeholder="ex: 8080">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="tpl-tags"><i class="fas fa-tags"></i> Tags (s√©par√©s par des virgules)</label>
                        <input type="text" id="tpl-tags" maxlength="255" placeholder="ex: web,python,education">
                        <small>Facultatif</small>
                    </div>

                    <div class="form-group">
                        <label for="tpl-service-type"><i class="fas fa-network-wired"></i> Mode d'acc√®s</label>
                        <select id="tpl-service-type">
                            <option value="ClusterIP">ClusterIP</option>
                            <option value="NodePort" selected>NodePort</option>
                            <option value="LoadBalancer">LoadBalancer</option>
                        </select>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="tpl-active" checked>
                        <label for="tpl-active">Actif</label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancel close-template-modal">Annuler</button>
                        <button type="submit" class="btn-save">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Modal : Import CSV
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="csv-import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-csv"></i> Importer des utilisateurs via CSV</h2>
                <button class="close-csv-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="notification info" id="csv-format-info" style="display:flex;">
                    <i class="fas fa-info-circle"></i>
                    <span>Format CSV attendu (avec en-t√™te) :<br>
                    <code>username,email,full_name,role,password</code><br>
                    R√¥les valides : <strong>student</strong>, <strong>teacher</strong>, <strong>admin</strong>.<br>
                    Mot de passe : 12 caract√®res min., maj., min., chiffre et caract√®re sp√©cial.</span>
                </div>

                <div id="csv-result-box" class="csv-result-box hidden"></div>

                <form id="csv-import-form">
                    <div class="form-group" style="margin-top:16px;">
                        <label for="csv-file-input"><i class="fas fa-upload"></i> Fichier CSV</label>
                        <input type="file" id="csv-file-input" accept=".csv" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel close-csv-modal">Annuler</button>
                        <button type="submit" class="btn-save" id="csv-import-submit">
                            <i class="fas fa-upload"></i> Importer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Modal : Quota Override
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="quota-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-tachometer-alt"></i> D√©rogation de quota</h2>
                <button class="close-quota-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="quota-modal-error" class="notification error hidden">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="quota-modal-error-text"></span>
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                </div>

                <p id="quota-modal-user-label" class="quota-user-label"></p>

                <div class="notification info" style="display:flex; margin-bottom:16px;">
                    <i class="fas fa-info-circle"></i>
                    <span>Laissez un champ vide pour utiliser la valeur par d√©faut du r√¥le.<br>
                    <strong>Permanent</strong> si "Expiration" est vide.</span>
                </div>

                <form id="quota-form">
                    <input type="hidden" id="quota-user-id">

                    <div class="form-row">
                        <div class="form-group">
                            <label for="quota-max-apps"><i class="fas fa-th-large"></i> Max labs</label>
                            <input type="number" id="quota-max-apps" min="0" max="99" placeholder="D√©faut du r√¥le">
                        </div>
                        <div class="form-group">
                            <label for="quota-max-cpu"><i class="fas fa-microchip"></i> Max CPU (millicores)</label>
                            <input type="number" id="quota-max-cpu" min="0" placeholder="ex: 2000">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="quota-max-mem"><i class="fas fa-memory"></i> Max M√©moire (MiB)</label>
                            <input type="number" id="quota-max-mem" min="0" placeholder="ex: 4096">
                        </div>
                        <div class="form-group">
                            <label for="quota-max-storage"><i class="fas fa-hdd"></i> Max Stockage (GiB)</label>
                            <input type="number" id="quota-max-storage" min="0" placeholder="ex: 20">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="quota-expires-at"><i class="fas fa-calendar-alt"></i> Expiration (vide = permanent)</label>
                        <input type="datetime-local" id="quota-expires-at">
                    </div>

                    <div id="quota-current-info" class="quota-current-info hidden"></div>

                    <div class="form-actions">
                        <button type="button" id="quota-delete-btn" class="btn-delete" style="margin-right:auto;">
                            <i class="fas fa-trash-alt"></i> Supprimer la d√©rogation
                        </button>
                        <button type="button" class="btn-cancel close-quota-modal">Annuler</button>
                        <button type="submit" class="btn-save">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Modal : Confirmation action admin sur un lab
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="lab-action-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="lab-action-modal-title"><i class="fas fa-exclamation-triangle"></i> Confirmation</h2>
                <button class="close-lab-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p id="lab-action-modal-body"></p>
                <p class="warning" id="lab-action-modal-warning"></p>
                <div class="form-actions">
                    <button type="button" class="btn-cancel close-lab-modal">Annuler</button>
                    <button type="button" id="lab-action-confirm-btn" class="btn-delete">Confirmer</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/admin-labs.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/runtime-configs.js"></script>

    <!-- ‚îÄ‚îÄ Gestion des onglets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <script>
    (function () {
        const tabBtns  = document.querySelectorAll('.tab-btn');
        const tabPanels = document.querySelectorAll('.tab-panel');

        function activateTab(tabId) {
            tabBtns.forEach(btn => {
                const active = btn.dataset.tab === tabId;
                btn.classList.toggle('active', active);
                btn.setAttribute('aria-selected', active);
            });
            tabPanels.forEach(panel => {
                panel.classList.toggle('active', panel.id === 'tab-' + tabId);
            });
            // Persist dans l'URL (hash) pour permettre le deep-link
            history.replaceState(null, '', '#' + tabId);
            // D√©clencher le chargement du parc des labs √† la premi√®re ouverture
            if (tabId === 'labs') {
                document.dispatchEvent(new CustomEvent('labs-tab-opened'));
            }
        }

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => activateTab(btn.dataset.tab));
        });

        // Deep-link via hash
        const hash = location.hash.replace('#', '');
        const validTabs = ['users', 'templates', 'runtimes', 'labs'];
        if (validTabs.includes(hash)) {
            activateTab(hash);
        }
    })();
    </script>
</body>
</html>
